Starting Impala Shell without Kerberos authentication
Opened TCP connection to test4:21000
Connected to test4:21000
Server version: impalad version 3.2.0-cdh6.3.2 RELEASE (build 1bb9836227301b839a32c6bc230e35439d5984ac)
Query: use tpc_test
Query: WITH web_v1 as (
select
ws_item_sk item_sk, d_date,
sum(sum(ws_sales_price))
over (partition by ws_item_sk order by d_date rows between unbounded preceding and current row) cume_sales
from web_sales
,date_dim
where ws_sold_date_sk=d_date_sk
and d_month_seq between 1215 and 1215+11
and ws_item_sk is not NULL
group by ws_item_sk, d_date),
store_v1 as (
select
ss_item_sk item_sk, d_date,
sum(sum(ss_sales_price))
over (partition by ss_item_sk order by d_date rows between unbounded preceding and current row) cume_sales
from store_sales
,date_dim
where ss_sold_date_sk=d_date_sk
and d_month_seq between 1215 and 1215+11
and ss_item_sk is not NULL
group by ss_item_sk, d_date)
select  *
from (select item_sk
,d_date
,web_sales
,store_sales
,max(web_sales)
over (partition by item_sk order by d_date rows between unbounded preceding and current row) web_cumulative
,max(store_sales)
over (partition by item_sk order by d_date rows between unbounded preceding and current row) store_cumulative
from (select case when web.item_sk is not null then web.item_sk else store.item_sk end item_sk
,case when web.d_date is not null then web.d_date else store.d_date end d_date
,web.cume_sales web_sales
,store.cume_sales store_sales
from web_v1 web full outer join store_v1 store on (web.item_sk = store.item_sk
and web.d_date = store.d_date)
)x )y
where web_cumulative > store_cumulative
order by item_sk
,d_date
limit 100
Query submitted at: 2020-06-10 02:21:30 (Coordinator: http://test4:25000)
Query progress can be monitored at: http://test4:25000/query_plan?query_id=5a4d7e4b776f37e5:1ee2b6ac00000000
+---------+---------------------+-----------+-------------+----------------+------------------+
| item_sk | d_date              | web_sales | store_sales | web_cumulative | store_cumulative |
+---------+---------------------+-----------+-------------+----------------+------------------+
| 3       | 2001-06-11 00:00:00 | 85.87     | NULL        | 85.87          | 80.89            |
| 3       | 2001-07-15 00:00:00 | 153.50    | NULL        | 153.50         | 131.09           |
| 3       | 2001-07-29 00:00:00 | 184.28    | NULL        | 184.28         | 131.09           |
| 3       | 2001-07-31 00:00:00 | 198.71    | NULL        | 198.71         | 131.09           |
| 19      | 2001-05-21 00:00:00 | 323.74    | NULL        | 323.74         | 246.07           |
| 19      | 2001-05-22 00:00:00 | NULL      | 256.12      | 323.74         | 256.12           |
| 19      | 2001-05-28 00:00:00 | NULL      | 317.07      | 323.74         | 317.07           |
| 19      | 2001-06-10 00:00:00 | NULL      | 318.40      | 323.74         | 318.40           |
| 19      | 2001-06-12 00:00:00 | 372.51    | NULL        | 372.51         | 318.40           |
| 19      | 2001-06-19 00:00:00 | 426.93    | NULL        | 426.93         | 318.40           |
| 19      | 2001-06-20 00:00:00 | NULL      | 359.95      | 426.93         | 359.95           |
| 19      | 2001-06-26 00:00:00 | NULL      | 370.18      | 426.93         | 370.18           |
| 19      | 2001-07-26 00:00:00 | NULL      | 377.13      | 426.93         | 377.13           |
| 19      | 2001-08-10 00:00:00 | NULL      | 387.78      | 426.93         | 387.78           |
| 19      | 2001-08-12 00:00:00 | 433.84    | NULL        | 433.84         | 387.78           |
| 19      | 2001-08-13 00:00:00 | NULL      | 404.52      | 433.84         | 404.52           |
| 21      | 2001-05-11 00:00:00 | NULL      | 12.21       | 13.00          | 12.21            |
| 24      | 2002-03-11 00:00:00 | 81.43     | NULL        | 81.43          | 65.64            |
| 24      | 2002-03-12 00:00:00 | 113.47    | NULL        | 113.47         | 65.64            |
| 24      | 2002-03-26 00:00:00 | NULL      | 88.69       | 113.47         | 88.69            |
| 25      | 2001-05-14 00:00:00 | 179.70    | NULL        | 179.70         | 146.76           |
| 25      | 2001-07-27 00:00:00 | 258.08    | NULL        | 258.08         | 200.85           |
| 25      | 2001-07-29 00:00:00 | 268.40    | NULL        | 268.40         | 200.85           |
| 25      | 2001-08-03 00:00:00 | NULL      | 213.47      | 268.40         | 213.47           |
| 25      | 2001-08-20 00:00:00 | NULL      | 223.57      | 268.40         | 223.57           |
| 25      | 2001-08-23 00:00:00 | NULL      | 241.18      | 268.40         | 241.18           |
| 25      | 2001-08-25 00:00:00 | NULL      | 251.52      | 268.40         | 251.52           |
| 29      | 2001-04-08 00:00:00 | 20.25     | NULL        | 20.25          | 16.13            |
| 30      | 2002-02-27 00:00:00 | 170.90    | NULL        | 170.90         | 153.51           |
| 30      | 2002-03-18 00:00:00 | NULL      | 165.86      | 170.90         | 165.86           |
| 31      | 2001-05-20 00:00:00 | 97.99     | NULL        | 97.99          | 29.05            |
| 31      | 2001-05-27 00:00:00 | NULL      | 37.14       | 97.99          | 37.14            |
| 31      | 2001-06-07 00:00:00 | 125.29    | NULL        | 125.29         | 37.14            |
| 31      | 2001-07-10 00:00:00 | NULL      | 58.82       | 125.29         | 58.82            |
| 31      | 2001-08-03 00:00:00 | NULL      | 64.43       | 125.29         | 64.43            |
| 31      | 2001-08-20 00:00:00 | NULL      | 77.26       | 125.29         | 77.26            |
| 31      | 2001-08-24 00:00:00 | NULL      | 98.88       | 125.29         | 98.88            |
| 35      | 2001-05-16 00:00:00 | 214.79    | NULL        | 214.79         | 201.30           |
| 35      | 2001-07-28 00:00:00 | 358.87    | NULL        | 358.87         | 333.23           |
| 35      | 2001-08-21 00:00:00 | 492.62    | NULL        | 492.62         | 447.81           |
| 35      | 2001-09-03 00:00:00 | NULL      | 469.10      | 492.62         | 469.10           |
| 35      | 2001-09-05 00:00:00 | 511.19    | NULL        | 511.19         | 469.10           |
| 35      | 2001-09-06 00:00:00 | NULL      | 507.02      | 511.19         | 507.02           |
| 36      | 2002-01-16 00:00:00 | 76.97     | 28.46       | 76.97          | 28.46            |
| 36      | 2002-03-11 00:00:00 | 207.73    | NULL        | 207.73         | 149.94           |
| 36      | 2002-03-17 00:00:00 | 279.87    | NULL        | 279.87         | 149.94           |
| 36      | 2002-03-25 00:00:00 | NULL      | 168.66      | 279.87         | 168.66           |
| 45      | 2001-05-19 00:00:00 | 151.46    | NULL        | 151.46         | 118.81           |
| 49      | 2001-04-08 00:00:00 | NULL      | 2.51        | 9.98           | 2.51             |
| 49      | 2001-04-19 00:00:00 | NULL      | 2.51        | 9.98           | 2.51             |
| 49      | 2001-05-10 00:00:00 | 26.46     | NULL        | 26.46          | 21.46            |
| 51      | 2001-04-12 00:00:00 | 96.75     | 24.55       | 96.75          | 24.55            |
| 51      | 2001-04-29 00:00:00 | NULL      | 82.69       | 96.75          | 82.69            |
| 53      | 2001-04-15 00:00:00 | 79.80     | NULL        | 79.80          | 7.14             |
| 53      | 2001-05-25 00:00:00 | 210.37    | 150.44      | 210.37         | 150.44           |
| 53      | 2001-06-01 00:00:00 | NULL      | 205.14      | 210.37         | 205.14           |
| 53      | 2001-06-12 00:00:00 | NULL      | 206.71      | 210.37         | 206.71           |
| 53      | 2001-06-17 00:00:00 | 392.28    | 234.16      | 392.28         | 234.16           |
| 53      | 2001-07-14 00:00:00 | NULL      | 348.83      | 392.28         | 348.83           |
| 53      | 2001-07-16 00:00:00 | 458.85    | NULL        | 458.85         | 348.83           |
| 53      | 2001-07-20 00:00:00 | NULL      | 421.76      | 458.85         | 421.76           |
| 53      | 2001-07-29 00:00:00 | 461.20    | NULL        | 461.20         | 421.76           |
| 53      | 2001-08-03 00:00:00 | NULL      | 441.09      | 461.20         | 441.09           |
| 53      | 2001-08-04 00:00:00 | NULL      | 458.85      | 461.20         | 458.85           |
| 65      | 2001-04-06 00:00:00 | 55.89     | NULL        | 55.89          | 42.60            |
| 65      | 2001-04-13 00:00:00 | 146.42    | NULL        | 146.42         | 42.60            |
| 65      | 2001-04-16 00:00:00 | 240.02    | NULL        | 240.02         | 42.60            |
| 65      | 2001-04-18 00:00:00 | NULL      | 42.60       | 240.02         | 42.60            |
| 65      | 2001-04-21 00:00:00 | NULL      | 65.90       | 240.02         | 65.90            |
| 65      | 2001-04-28 00:00:00 | NULL      | 69.33       | 240.02         | 69.33            |
| 65      | 2001-05-09 00:00:00 | 298.31    | NULL        | 298.31         | 69.33            |
| 65      | 2001-05-13 00:00:00 | NULL      | 74.10       | 298.31         | 74.10            |
| 65      | 2001-05-18 00:00:00 | NULL      | 148.46      | 298.31         | 148.46           |
| 65      | 2001-05-25 00:00:00 | NULL      | 203.29      | 298.31         | 203.29           |
| 65      | 2001-05-31 00:00:00 | 306.49    | NULL        | 306.49         | 203.29           |
| 65      | 2001-06-11 00:00:00 | NULL      | 293.88      | 306.49         | 293.88           |
| 69      | 2001-04-23 00:00:00 | 103.95    | NULL        | 103.95         | 66.75            |
| 69      | 2001-10-07 00:00:00 | 512.34    | NULL        | 512.34         | 510.29           |
| 69      | 2001-10-09 00:00:00 | NULL      | 510.29      | 512.34         | 510.29           |
| 72      | 2002-01-05 00:00:00 | 12.40     | NULL        | 12.40          | 5.28             |
| 73      | 2001-04-24 00:00:00 | 72.03     | 32.37       | 72.03          | 32.37            |
| 73      | 2001-04-30 00:00:00 | NULL      | 54.48       | 72.03          | 54.48            |
| 73      | 2001-05-10 00:00:00 | NULL      | 54.67       | 72.03          | 54.67            |
| 73      | 2001-05-16 00:00:00 | NULL      | 62.34       | 72.03          | 62.34            |
| 73      | 2001-05-19 00:00:00 | NULL      | 64.98       | 72.03          | 64.98            |
| 73      | 2001-06-02 00:00:00 | 103.37    | NULL        | 103.37         | 64.98            |
| 73      | 2001-06-20 00:00:00 | 133.80    | NULL        | 133.80         | 122.88           |
| 73      | 2001-06-21 00:00:00 | NULL      | 124.49      | 133.80         | 124.49           |
| 73      | 2001-06-23 00:00:00 | NULL      | 128.37      | 133.80         | 128.37           |
| 73      | 2001-07-04 00:00:00 | NULL      | 129.86      | 133.80         | 129.86           |
| 81      | 2001-04-17 00:00:00 | NULL      | 5.85        | 55.98          | 5.85             |
| 81      | 2001-04-18 00:00:00 | NULL      | 24.32       | 55.98          | 24.32            |
| 81      | 2001-05-10 00:00:00 | 127.64    | NULL        | 127.64         | 24.32            |
| 81      | 2001-05-12 00:00:00 | NULL      | 34.84       | 127.64         | 34.84            |
| 81      | 2001-06-05 00:00:00 | NULL      | 109.97      | 127.64         | 109.97           |
| 81      | 2001-06-21 00:00:00 | 237.19    | NULL        | 237.19         | 109.97           |
| 81      | 2001-06-22 00:00:00 | NULL      | 116.48      | 237.19         | 116.48           |
| 81      | 2001-07-09 00:00:00 | NULL      | 140.87      | 237.19         | 140.87           |
| 81      | 2001-07-19 00:00:00 | 261.46    | NULL        | 261.46         | 250.32           |
| 81      | 2001-08-16 00:00:00 | 396.17    | NULL        | 396.17         | 392.67           |
+---------+---------------------+-----------+-------------+----------------+------------------+
Fetched 100 row(s) in 1.28s
