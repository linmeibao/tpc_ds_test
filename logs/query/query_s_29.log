Starting Impala Shell without Kerberos authentication
Opened TCP connection to test4:21000
Connected to test4:21000
Server version: impalad version 3.2.0-cdh6.3.2 RELEASE (build 1bb9836227301b839a32c6bc230e35439d5984ac)
Query: use tpc_test
Query: with ss as
(select ca_county,d_qoy, d_year,sum(ss_ext_sales_price) as store_sales
from store_sales,date_dim,customer_address
where ss_sold_date_sk = d_date_sk
and ss_addr_sk=ca_address_sk
group by ca_county,d_qoy, d_year),
ws as
(select ca_county,d_qoy, d_year,sum(ws_ext_sales_price) as web_sales
from web_sales,date_dim,customer_address
where ws_sold_date_sk = d_date_sk
and ws_bill_addr_sk=ca_address_sk
group by ca_county,d_qoy, d_year)
select
ss1.ca_county
,ss1.d_year
,ws2.web_sales/ws1.web_sales web_q1_q2_increase
,ss2.store_sales/ss1.store_sales store_q1_q2_increase
,ws3.web_sales/ws2.web_sales web_q2_q3_increase
,ss3.store_sales/ss2.store_sales store_q2_q3_increase
from
ss ss1
,ss ss2
,ss ss3
,ws ws1
,ws ws2
,ws ws3
where
ss1.d_qoy = 1
and ss1.d_year = 1999
and ss1.ca_county = ss2.ca_county
and ss2.d_qoy = 2
and ss2.d_year = 1999
and ss2.ca_county = ss3.ca_county
and ss3.d_qoy = 3
and ss3.d_year = 1999
and ss1.ca_county = ws1.ca_county
and ws1.d_qoy = 1
and ws1.d_year = 1999
and ws1.ca_county = ws2.ca_county
and ws2.d_qoy = 2
and ws2.d_year = 1999
and ws1.ca_county = ws3.ca_county
and ws3.d_qoy = 3
and ws3.d_year =1999
and case when ws1.web_sales > 0 then ws2.web_sales/ws1.web_sales else null end
> case when ss1.store_sales > 0 then ss2.store_sales/ss1.store_sales else null end
and case when ws2.web_sales > 0 then ws3.web_sales/ws2.web_sales else null end
> case when ss2.store_sales > 0 then ss3.store_sales/ss2.store_sales else null end
order by ss1.ca_county
Query submitted at: 2020-06-10 02:21:31 (Coordinator: http://test4:25000)
Query progress can be monitored at: http://test4:25000/query_plan?query_id=334bf0fddad4a27f:fc46ff2100000000
+---------------------+--------+--------------------+----------------------+--------------------+----------------------+
| ca_county           | d_year | web_q1_q2_increase | store_q1_q2_increase | web_q2_q3_increase | store_q2_q3_increase |
+---------------------+--------+--------------------+----------------------+--------------------+----------------------+
| Allen County        | 1999   | 2.584080           | 1.807025             | 1.771143           | 0.707736             |
| Assumption Parish   | 1999   | 1.974211           | 1.738543             | 1.546898           | 0.862802             |
| Barnwell County     | 1999   | 2.960795           | 1.323612             | 0.798269           | 0.221148             |
| Bristol County      | 1999   | 1.568645           | 0.521069             | 0.839931           | 0.646805             |
| Camden County       | 1999   | 1.592953           | 0.803492             | 2.978876           | 1.858186             |
| Charles Mix County  | 1999   | 3.357465           | 0.246548             | 0.896660           | 0.748102             |
| Chickasaw County    | 1999   | 0.958376           | 0.563933             | 1.940111           | 0.622751             |
| Claiborne County    | 1999   | 0.997356           | 0.692805             | 4.327476           | 1.396985             |
| Clay County         | 1999   | 0.708215           | 0.617352             | 3.592323           | 1.987497             |
| Colfax County       | 1999   | 2.058835           | 1.541109             | 1.029903           | 0.570132             |
| Columbia County     | 1999   | 0.874984           | 0.809761             | 4.483702           | 2.861252             |
| Costilla County     | 1999   | 2.563849           | 0.749598             | 1.174129           | 0.336564             |
| Dawson County       | 1999   | 0.856997           | 0.529924             | 4.557289           | 1.579465             |
| Delaware County     | 1999   | 0.739849           | 0.670261             | 1.927278           | 0.976557             |
| Emmet County        | 1999   | 0.554485           | 0.516265             | 5.423855           | 3.904018             |
| Gallatin County     | 1999   | 4.134973           | 1.151616             | 1.407726           | 1.246072             |
| Hancock County      | 1999   | 2.410444           | 0.975579             | 2.144739           | 1.535143             |
| Haskell County      | 1999   | 1.653972           | 0.583593             | 4.838418           | 2.315813             |
| Hawaii County       | 1999   | 1.669303           | 0.708500             | 1.346779           | 1.267082             |
| Lamb County         | 1999   | 1.337560           | 1.001013             | 1.811509           | 1.160166             |
| Leavenworth County  | 1999   | 0.488324           | 0.230878             | 2.055206           | 1.637530             |
| Lincoln County      | 1999   | 2.234462           | 1.028485             | 2.068554           | 1.714843             |
| Lynn County         | 1999   | 1.632527           | 1.087026             | 2.148943           | 1.611568             |
| Mahaska County      | 1999   | 0.232569           | 0.200190             | 7.056416           | 0.782368             |
| Manatee County      | 1999   | 3.306777           | 0.568529             | 1.776269           | 1.384741             |
| Meigs County        | 1999   | 5.957322           | 2.268129             | 1.702621           | 0.886028             |
| Mills County        | 1999   | 1.402796           | 0.648990             | 1.996679           | 1.911181             |
| Moore County        | 1999   | 1.679396           | 0.658851             | 5.120364           | 1.864673             |
| Orange County       | 1999   | 0.870786           | 0.385353             | 5.229507           | 4.392010             |
| Putnam County       | 1999   | 1.399985           | 0.531418             | 2.036396           | 1.744409             |
| Richland County     | 1999   | 1.561083           | 0.792143             | 3.354409           | 1.326373             |
| Ritchie County      | 1999   | 2.488086           | 1.865138             | 1.514672           | 1.127917             |
| Saguache County     | 1999   | 1.803131           | 1.162532             | 1.452468           | 1.120033             |
| San Miguel County   | 1999   | 1.499996           | 0.748306             | 1.444584           | 0.524684             |
| Shelby County       | 1999   | 1.102547           | 0.879281             | 2.116624           | 1.889541             |
| Stephens County     | 1999   | 0.799516           | 0.657777             | 7.716211           | 1.981302             |
| Todd County         | 1999   | 1.033992           | 0.613376             | 1.744681           | 1.711337             |
| Trinity County      | 1999   | 1.743528           | 0.913319             | 2.397271           | 1.550028             |
| Westmoreland County | 1999   | 1.714091           | 0.711131             | 2.465697           | 2.054941             |
| Whiteside County    | 1999   | 5.652893           | 1.201638             | 1.051035           | 0.081350             |
| Wood County         | 1999   | 1.988631           | 0.927631             | 4.671994           | 1.927517             |
| Worcester County    | 1999   | 0.750094           | 0.639052             | 4.550992           | 4.074914             |
| Wyoming County      | 1999   | 1.664838           | 1.091548             | 1.779327           | 1.020345             |
+---------------------+--------+--------------------+----------------------+--------------------+----------------------+
Fetched 43 row(s) in 2.15s
