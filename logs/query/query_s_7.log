Starting Impala Shell without Kerberos authentication
Opened TCP connection to test4:21000
Connected to test4:21000
Server version: impalad version 3.2.0-cdh6.3.2 RELEASE (build 1bb9836227301b839a32c6bc230e35439d5984ac)
Query: use tpc_test
Query: with ws as
(select d_year AS ws_sold_year, ws_item_sk,
ws_bill_customer_sk ws_customer_sk,
sum(ws_quantity) ws_qty,
sum(ws_wholesale_cost) ws_wc,
sum(ws_sales_price) ws_sp
from web_sales
left join web_returns on wr_order_number=ws_order_number and ws_item_sk=wr_item_sk
join date_dim on ws_sold_date_sk = d_date_sk
where wr_order_number is null
group by d_year, ws_item_sk, ws_bill_customer_sk
),
cs as
(select d_year AS cs_sold_year, cs_item_sk,
cs_bill_customer_sk cs_customer_sk,
sum(cs_quantity) cs_qty,
sum(cs_wholesale_cost) cs_wc,
sum(cs_sales_price) cs_sp
from catalog_sales
left join catalog_returns on cr_order_number=cs_order_number and cs_item_sk=cr_item_sk
join date_dim on cs_sold_date_sk = d_date_sk
where cr_order_number is null
group by d_year, cs_item_sk, cs_bill_customer_sk
),
ss as
(select d_year AS ss_sold_year, ss_item_sk,
ss_customer_sk,
sum(ss_quantity) ss_qty,
sum(ss_wholesale_cost) ss_wc,
sum(ss_sales_price) ss_sp
from store_sales
left join store_returns on sr_ticket_number=ss_ticket_number and ss_item_sk=sr_item_sk
join date_dim on ss_sold_date_sk = d_date_sk
where sr_ticket_number is null
group by d_year, ss_item_sk, ss_customer_sk
)
select
ss_customer_sk,
round(ss_qty/(coalesce(ws_qty,0)+coalesce(cs_qty,0)),2) ratio,
ss_qty store_qty, ss_wc store_wholesale_cost, ss_sp store_sales_price,
coalesce(ws_qty,0)+coalesce(cs_qty,0) other_chan_qty,
coalesce(ws_wc,0)+coalesce(cs_wc,0) other_chan_wholesale_cost,
coalesce(ws_sp,0)+coalesce(cs_sp,0) other_chan_sales_price
from ss
left join ws on (ws_sold_year=ss_sold_year and ws_item_sk=ss_item_sk and ws_customer_sk=ss_customer_sk)
left join cs on (cs_sold_year=ss_sold_year and cs_item_sk=ss_item_sk and cs_customer_sk=ss_customer_sk)
where (coalesce(ws_qty,0)>0 or coalesce(cs_qty, 0)>0) and ss_sold_year=2001
order by
ss_customer_sk,
ss_qty desc, ss_wc desc, ss_sp desc,
other_chan_qty,
other_chan_wholesale_cost,
other_chan_sales_price,
ratio
limit 100
Query submitted at: 2020-06-10 02:22:24 (Coordinator: http://test4:25000)
Query progress can be monitored at: http://test4:25000/query_plan?query_id=5840ef8e386eb9da:6df53a6400000000
+----------------+--------------------+-----------+----------------------+-------------------+----------------+---------------------------+------------------------+
| ss_customer_sk | ratio              | store_qty | store_wholesale_cost | store_sales_price | other_chan_qty | other_chan_wholesale_cost | other_chan_sales_price |
+----------------+--------------------+-----------+----------------------+-------------------+----------------+---------------------------+------------------------+
| 373            | 1.69               | 98        | 73.85                | 9.65              | 58             | 79.31                     | 89.33                  |
| 1302           | 0.48               | 10        | 73.37                | 24.85             | 21             | 46.46                     | 88.08                  |
| 1861           | 0.63               | 48        | 51.02                | 12.98             | 76             | 19.12                     | 11.83                  |
| 2415           | 0.82               | 69        | 87.49                | 34.29             | 84             | 65.79                     | 7.99                   |
| 4169           | 0.47               | 26        | 67.91                | 86.43             | 55             | 87.94                     | 14.35                  |
| 4843           | 0.37               | 35        | 39.85                | 11.10             | 95             | 29.53                     | 17.50                  |
| 5138           | 0.95               | 18        | 68.02                | 58.11             | 19             | 92.98                     | 201.76                 |
| 5146           | 0.8100000000000001 | 39        | 35.53                | 9.32              | 48             | 65.81                     | 64.99                  |
| 5835           | 0.58               | 25        | 34.22                | 40.31             | 43             | 95.47                     | 69.16                  |
| 5838           | 4.33               | 26        | 33.23                | 37.48             | 6              | 54.20                     | 37.72                  |
| 6072           | 5.67               | 17        | 8.58                 | 11.18             | 3              | 98.93                     | 133.01                 |
| 6128           | 0.86               | 42        | 74.15                | 49.77             | 49             | 77.31                     | 172.97                 |
| 6292           | 0.01               | 1         | 94.97                | 10.99             | 86             | 79.39                     | 28.32                  |
| 6426           | 0.03               | 1         | 46.00                | 33.38             | 37             | 81.77                     | 116.74                 |
| 6529           | 2.79               | 39        | 82.20                | 62.14             | 14             | 82.37                     | 128.78                 |
| 6968           | NULL               | NULL      | 74.10                | NULL              | 11             | 84.51                     | 123.82                 |
| 7005           | 0.75               | 21        | 41.62                | 32.77             | 28             | 38.70                     | 10.21                  |
| 7161           | 1.08               | 92        | 83.91                | 40.13             | 85             | 33.67                     | 37.89                  |
| 7244           | 0.53               | 52        | 47.94                | 29.51             | 99             | 77.00                     | 56.54                  |
| 8030           | 0.75               | 74        | 30.43                | 28.03             | 99             | 17.36                     | 21.48                  |
| 8322           | 0.64               | 54        | 76.27                | 12.96             | 84             | 44.96                     | 84.16                  |
| 9555           | 0.58               | 45        | 70.72                | 54.45             | 78             | 29.16                     | 11.54                  |
| 9686           | 0.65               | 62        | 54.84                | 49.50             | 95             | 31.53                     | 36.18                  |
| 9932           | 0.13               | 2         | 31.75                | 12.86             | 15             | 65.47                     | 43.23                  |
| 10604          | 92                 | 92        | 75.75                | 104.98            | 1              | 58.64                     | 5.39                   |
| 11485          | 3.5                | 91        | 31.65                | 9.91              | 26             | 3.66                      | 1.27                   |
| 12313          | 1.79               | 61        | 47.28                | 59.54             | 34             | 39.55                     | 57.47                  |
| 12351          | 4.67               | 14        | 49.04                | 11.67             | 3              | 83.46                     | 23.62                  |
| 12954          | 2.1                | 63        | 78.38                | 112.10            | 30             | 51.41                     | 14.87                  |
| 13798          | 4.92               | 64        | 42.77                | 45.03             | 13             | 2.28                      | 1.58                   |
| 14070          | 0.16               | 13        | 6.18                 | 5.29              | 83             | 21.99                     | 39.59                  |
| 15217          | 0.65               | 63        | 77.94                | 32.95             | 97             | 90.71                     | 42.72                  |
| 15894          | 1.18               | 100       | 93.86                | 31.42             | 85             | 96.22                     | 109.41                 |
| 15926          | 2.4                | 72        | 14.29                | 0.00              | 30             | 16.44                     | 2.10                   |
| 16065          | 42                 | 84        | 40.51                | 57.50             | 2              | 6.94                      | 7.89                   |
| 16602          | 1.02               | 52        | 97.93                | 116.13            | 51             | 75.05                     | 98.46                  |
| 17427          | 2.63               | 92        | 52.80                | 52.56             | 35             | 55.82                     | 54.40                  |
| 19171          | 1.67               | 20        | 32.85                | 38.10             | 12             | 80.56                     | 20.51                  |
| 19186          | 0.14               | 5         | 88.62                | 19.88             | 36             | 33.45                     | 19.33                  |
| 19240          | 0.25               | 16        | 62.07                | 85.00             | 64             | 37.07                     | 8.74                   |
| 20034          | 4.56               | 73        | 29.82                | 30.56             | 16             | 27.41                     | 51.61                  |
| 20586          | 0.5600000000000001 | 41        | 38.01                | 33.20             | 73             | 65.36                     | 2.05                   |
| 21195          | 0.9                | 54        | 19.31                | 27.71             | 60             | 31.48                     | 14.93                  |
| 21385          | 0.86               | 62        | 34.41                | 44.55             | 72             | 93.19                     | 102.40                 |
| 22265          | 0.38               | 21        | 4.49                 | 4.35              | 56             | 88.99                     | 216.24                 |
| 22794          | 0.32               | 29        | 96.94                | 62.69             | 90             | 87.83                     | 168.05                 |
| 23674          | 0.22               | 11        | 23.54                | 2.99              | 50             | 7.17                      | 2.19                   |
| 23682          | 0.1                | 7         | 82.27                | 98.47             | 71             | 18.91                     | 27.42                  |
| 23783          | 0.91               | 39        | 93.87                | 79.41             | 43             | 39.61                     | 77.22                  |
| 24083          | 4.88               | 39        | 79.98                | 6.84              | 8              | 77.36                     | 60.10                  |
| 24114          | 0.44               | 31        | 67.38                | 39.46             | 70             | 78.26                     | 44.75                  |
| 26511          | 7.43               | 52        | 80.66                | 122.74            | 7              | 7.64                      | 14.72                  |
| 28636          | 9.4                | 47        | 62.59                | 25.84             | 5              | 5.99                      | 0.43                   |
| 28718          | 1                  | 18        | 67.41                | 78.98             | 18             | 27.10                     | 7.46                   |
| 28743          | 4.14               | 58        | 60.89                | 19.94             | 14             | 38.85                     | 9.82                   |
| 29192          | 0.33               | 27        | 96.05                | 33.50             | 81             | 41.74                     | 13.72                  |
| 29779          | 1.07               | 49        | 47.60                | 13.93             | 46             | 69.82                     | 50.14                  |
| 29852          | 0.14               | 13        | 99.24                | 1.51              | 90             | 28.86                     | 12.61                  |
| 30113          | 0.4                | 10        | 18.01                | 0.00              | 25             | 19.40                     | 7.21                   |
| 30522          | 0.84               | 81        | 20.37                | 11.98             | 97             | 18.26                     | 27.58                  |
| 30649          | 0.37               | 29        | 18.08                | 13.31             | 79             | 58.12                     | 10.20                  |
| 30746          | 0.89               | 32        | 40.71                | 5.34              | 36             | 28.28                     | 28.29                  |
| 31695          | 6.67               | 40        | 48.98                | 11.72             | 6              | 62.33                     | 145.48                 |
| 31868          | 2.09               | 67        | 66.79                | 54.64             | 32             | 75.13                     | 33.26                  |
| 32572          | 0.54               | 48        | 82.29                | 15.63             | 89             | 11.72                     | 27.63                  |
| 33698          | 0.74               | 56        | 2.63                 | 2.47              | 76             | 55.62                     | 31.57                  |
| 34637          | 0.13               | 4         | 13.45                | 15.84             | 30             | 33.09                     | 33.58                  |
| 34843          | 21                 | 21        | 92.20                | 101.06            | 1              | 57.84                     | 40.05                  |
| 35487          | 0.14               | 4         | 56.23                | 31.28             | 28             | 58.97                     | 55.34                  |
| 35537          | 1.4                | 60        | 90.29                | 57.39             | 43             | 79.24                     | 207.88                 |
| 36179          | 1.42               | 61        | 74.72                | 94.68             | 43             | 32.78                     | 76.60                  |
| 36905          | 0.33               | 29        | 60.60                | 61.42             | 88             | 51.15                     | 20.58                  |
| 37826          | 0.5600000000000001 | 19        | 33.53                | 51.59             | 34             | 29.46                     | 6.36                   |
| 38356          | 12                 | 60        | 85.12                | 19.82             | 5              | 88.85                     | 83.37                  |
| 38652          | 0.13               | 13        | 39.35                | 11.80             | 100            | 36.14                     | 23.01                  |
| 38668          | 1.54               | 83        | 82.14                | 68.30             | 54             | 44.04                     | 68.16                  |
| 38875          | 0.8                | 33        | 70.91                | 111.59            | 41             | 91.78                     | 160.09                 |
| 39082          | 5.8                | 87        | 71.32                | 56.73             | 15             | 1.66                      | 1.51                   |
| 39322          | 1.45               | 61        | 44.76                | 11.05             | 42             | 1.29                      | 0.00                   |
| 40837          | 2.63               | 100       | 58.74                | 52.72             | 38             | 82.29                     | 84.49                  |
| 40907          | 3.79               | 91        | 33.85                | 37.34             | 24             | 92.53                     | 209.16                 |
| 41474          | 6                  | 78        | 70.58                | 72.41             | 13             | 15.25                     | 22.93                  |
| 47436          | 0.17               | 3         | 22.20                | 6.64              | 18             | 78.66                     | 228.11                 |
| 48202          | 0.01               | 1         | 64.05                | 80.74             | 81             | 85.56                     | 54.25                  |
| 48525          | 0.33               | 12        | 97.86                | 84.54             | 36             | 8.51                      | 8.04                   |
| 48606          | 0.85               | 66        | 84.42                | 70.73             | 78             | 10.44                     | 11.03                  |
| 48713          | 0.61               | 17        | 51.26                | 50.10             | 28             | 93.64                     | 117.79                 |
| 48818          | 2.23               | 87        | 45.23                | 7.34              | 39             | 2.74                      | 5.78                   |
| 49027          | 1.47               | 50        | 59.72                | 42.35             | 34             | 57.24                     | 48.21                  |
| 49301          | 7.75               | 93        | 91.50                | 73.96             | 12             | 64.80                     | 57.64                  |
| 50574          | 0.8                | 61        | 65.23                | 52.96             | 76             | 57.65                     | 21.44                  |
| 51602          | 0.87               | 86        | 69.75                | 93.79             | 99             | 43.27                     | 64.96                  |
| 53909          | 18.25              | 73        | 26.45                | 26.23             | 4              | 77.01                     | 31.88                  |
| 54463          | 0.44               | 40        | 87.94                | 87.92             | 90             | 83.62                     | 124.81                 |
| 55264          | 0.63               | 22        | 7.48                 | 2.62              | 35             | 62.72                     | 82.25                  |
| 55736          | 1.94               | 95        | 40.15                | 16.06             | 49             | 58.52                     | 134.68                 |
| 57282          | 0.9                | 65        | 89.26                | 120.49            | 72             | 53.35                     | 77.81                  |
| 57791          | 0.27               | 21        | 17.10                | 16.31             | 77             | 81.90                     | 133.64                 |
| 57932          | 0.61               | 57        | 36.89                | 36.44             | 94             | 52.80                     | 40.86                  |
| 58004          | 1.17               | 77        | 16.66                | 4.45              | 66             | 33.84                     | 20.58                  |
+----------------+--------------------+-----------+----------------------+-------------------+----------------+---------------------------+------------------------+
Fetched 100 row(s) in 1.11s
